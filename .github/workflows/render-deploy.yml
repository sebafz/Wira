name: Render Deploy

on:
  push:
    branches: [dev, main]
  workflow_dispatch:

jobs:
  trigger-render:
    name: Trigger Render Deploy
    runs-on: ubuntu-latest
    steps:
      - name: Deploy dev services
        if: github.ref_name == 'dev'
        env:
          API_HOOK: ${{ secrets.RENDER_HOOK_API_DEV }}
          WEB_HOOK: ${{ secrets.RENDER_HOOK_WEB_DEV }}
        run: |
          set -euo pipefail
          echo "Triggering Render deploy for dev branch"
          for hook in "$API_HOOK" "$WEB_HOOK"; do
            if [ -z "$hook" ]; then
              echo "Missing Render deploy hook secret for dev" >&2
              exit 1
            fi
          done
          curl -fsS -X POST "$API_HOOK"
          curl -fsS -X POST "$WEB_HOOK"

      - name: Deploy main services
        if: github.ref_name == 'main'
        env:
          API_HOOK: ${{ secrets.RENDER_HOOK_API_PROD }}
          WEB_HOOK: ${{ secrets.RENDER_HOOK_WEB_PROD }}
        run: |
          set -euo pipefail
          echo "Triggering Render deploy for main branch"
          for hook in "$API_HOOK" "$WEB_HOOK"; do
            if [ -z "$hook" ]; then
              echo "Missing Render deploy hook secret for main" >&2
              exit 1
            fi
          done
          curl -fsS -X POST "$API_HOOK"
          curl -fsS -X POST "$WEB_HOOK"
